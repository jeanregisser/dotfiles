#!/usr/bin/env zsh

source "$(dirname "$0")/script-helpers"

msg "Homebrew: Brews"

# Make sure weâ€™re using the latest Homebrew
brew update

# Upgrade any already-installed formulae
brew upgrade --all

FORMULAE=(
	coreutils
	"vim --override-system-vi"
	git
	git-extras
	hub
	legit
	the_silver_searcher
	figlet
	grc
	homebrew/versions/mongodb24
	mongodb
	redis
	node
	autojump
	nmap
	wget
	resty
	rbenv
	ruby-build
	libxml2
	libidn
	libcouchbase
	python
	mitmproxy
	class-dump
	gist
	parallel
	mobile-shell
	ssh-copy-id
	uncrustify
	imagemagick
	xctool
	heroku-toolbelt
	archey
	tree
	lighttpd
	jq
	watchman
	flow
	aria2
	ctags
	mackup
	s3cmd
	caskroom/cask/brew-cask
	)

INSTALLED_FORMULAE="$(brew list -1)"

for formula in "${FORMULAE[@]}"
do
	NAME="$(awk '{ print $1 }' <<< "$formula")"
	SHORT_NAME="$(basename "$NAME")"

	if ! grep -qx "$SHORT_NAME" <<< "$INSTALLED_FORMULAE"; then
		brew install ${(z)formula}
	fi
done

# Remove outdated versions from the cellar
brew cleanup
